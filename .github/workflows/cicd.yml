name: KBOT-CI-CD

on: push

jobs:
    ci:
        name: CI
        runs-on: ubuntu-latest

        steps:
            - name: Checkout
              uses: actions/checkout@v3
              with:
                fetch-depth: 0

            - run: go version

            - name: Run test
              run:  make test 

            - name: Docker Hub login
              uses: docker/login-action@v2
              with:
                username: ${{ secrets.DOCKERHUB_USERNAME }} 
                password: ${{ secrets.DOCKERHUB_TOKEN}}
            
            - name: Build&Push
              env:
                APP: "kbot"
                REGESTRY: ${{ secrets.DOCKERHUB_USERNAME}}
              run: make image push

